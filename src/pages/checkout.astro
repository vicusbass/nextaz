---
import Layout from '../layouts/Layout.astro';
import CheckoutForm from '../components/checkout/CheckoutForm.svelte';
import { client } from '../utils/sanity';

// Fetch shipping configuration from Sanity
const shopData = await client.fetch<{
  shippingPrice: number;
  freeShippingThreshold: number;
} | null>(`*[_type == "shop"][0]{ shippingPrice, freeShippingThreshold }`);

const shippingPrice = shopData?.shippingPrice ?? 0;
const freeShippingThreshold = shopData?.freeShippingThreshold ?? 0;
---

<Layout title="Finalizare comandă | Nextaz">
  <section class="checkout-page bg-white px-6 pt-32 pb-16 lg:px-30 lg:pt-40 lg:pb-24">
    <div class="checkout-header mb-8 lg:mb-12">
      <a href="/cart" class="back-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
        <span>Înapoi la coș</span>
      </a>
      <h1 class="text-3xl font-bold text-black lg:text-5xl">Finalizare comandă</h1>
    </div>

    <div class="checkout-content">
      <CheckoutForm
        client:load
        shippingPrice={shippingPrice}
        freeShippingThreshold={freeShippingThreshold}
      />
    </div>
  </section>
</Layout>

<style>
  .checkout-header {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: #6e6e6e;
    text-decoration: none;
    transition: color 0.2s;
  }

  .back-link:hover {
    color: #000;
  }

  .back-link svg {
    width: 1rem;
    height: 1rem;
  }

  .checkout-content {
    max-width: 700px;
  }
</style>
