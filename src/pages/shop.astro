---
import Layout from '../layouts/Layout.astro';
import { Image } from 'astro:assets';
import heroImage from '../assets/shop/wine-hero.png';
import { loadQuery } from '../utils/loadQuery';
import { shopQuery } from '../queries/shop';
import SingleProductCard from '../components/SingleProductCard.astro';
import PackageProductCard from '../components/PackageProductCard.astro';

interface Product {
  _id: string;
  name: string;
  slug: { current: string };
  productType: 'single' | 'package' | 'bundle';
  image: any;
  description: string;
  price: number;
}

interface Shop {
  title: string;
  products: Product[];
}

const { data: shop } = await loadQuery<Shop>({ query: shopQuery });
const products = shop?.products ?? [];

// Separate products by type
const singleProducts = products.filter((p) => p.productType === 'single');
const packages = products.filter((p) => p.productType === 'package' || p.productType === 'bundle');
---

<Layout title="Shop | Nextaz">
  <!-- Hero Section -->
  <section
    id="shop-hero"
    class="bg-gray-light flex flex-col overflow-hidden px-0 pt-32 lg:h-[1080px] lg:flex-row lg:px-30 lg:pt-10"
  >
    <div
      class="order-2 flex flex-col items-center justify-center text-center lg:order-0 lg:w-[700px] lg:shrink-0 lg:items-start lg:text-left"
    >
      <h1 class="mb-4 text-5xl leading-none font-bold lg:mb-12 lg:text-9xl">Shop</h1>
      <h2 class="mb-6 text-2xl leading-none font-bold lg:text-5xl">Alege vinul tău preferat</h2>
      <p
        class="text-gray-dark mb-50 max-w-[600px] px-6 text-lg leading-relaxed lg:px-0 lg:text-xl lg:text-black"
      >
        Descoperă gama Nextaz și comandă vinuri pentru acasă, cadouri, petreceri sau evenimente
        speciale.
      </p>
    </div>
    <div
      class="flex h-[60vh] w-full items-center justify-center lg:-ml-[400px] lg:h-auto lg:w-[1600px] lg:justify-start"
    >
      <Image
        src={heroImage}
        alt="Vinuri Nextaz - selecție de vinuri albe și rosé"
        class="h-full w-full object-cover object-center lg:origin-left lg:scale-120 lg:object-left"
      />
    </div>
  </section>

  <!-- Products Section -->
  <section id="products" class="bg-white px-6 pb-16 lg:px-30 lg:pb-24">
    <!-- Single Wine Products Grid - 2 columns on desktop -->
    {
      singleProducts.length > 0 && (
        <div class="grid grid-cols-1 gap-4 lg:grid-cols-2">
          {singleProducts.map((product, index) => (
            <div class={index < 2 ? `relative z-10 lg:-mt-16 ${index === 0 ? '-mt-12' : ''}` : ''}>
              <SingleProductCard product={product} />
            </div>
          ))}
        </div>
      )
    }

    <!-- Package Products - Full Width -->
    {
      packages.length > 0 && (
        <div class="mt-4 flex flex-col gap-6 lg:gap-8">
          {packages.map((product) => (
            <div class="w-full">
              <PackageProductCard product={product} />
            </div>
          ))}
        </div>
      )
    }
  </section>
</Layout>
